#!/usr/bin/env ruby

require File.expand_path(
    File.join(File.dirname(__FILE__), '..', 'lib', 'pingfm'))

keyloader = ::Pingfm::Keyloader.new
unless keyloader.has_keys?
  keyloader.api_key = 'e92ca0bc475ea072590791d28b133544'
  puts 'Enter your ping.fm key from http://ping.fm/key/ here: '
  keyloader.app_key = STDIN.gets.chomp
  keyloader.save
end

# post message from ARGV

pingfm = ::Pingfm::Client.new(keyloader.api_key, keyloader.app_key)

s = pingfm.validate
if s['status'] == 'OK'
  status = ARGV.join(' ')
  post_result = pingfm.post(status)
  if s['status'] == 'FAIL'
    puts s['message']
  else
    puts 'message sent'
  end
else
  puts s['message']
end

# EOF
